# Jobdori ëª¨ë‹ˆí„°ë§ ì›Œí¬í”Œë¡œìš°
# ìˆ˜ë™ ì‹¤í–‰ ë° ìžë™ ìŠ¤ì¼€ì¤„ ì§€ì›

name: Jobdori Monitoring

on:
  # ìˆ˜ë™ ì‹¤í–‰ (GitHub Actions íŽ˜ì´ì§€ì—ì„œ "Run workflow" ë²„íŠ¼)
  workflow_dispatch:

  # ìžë™ ì‹¤í–‰ ìŠ¤ì¼€ì¤„ (ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ = UTC 0ì‹œ)
  schedule:
    - cron: '0 0 * * *'

env:
  NODE_VERSION: '20'

jobs:
  monitoring:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¦ Install dependencies
        run: npm ci

      - name: ðŸš€ Run Full Pipeline
        env:
          SERPER_API_KEY: ${{ secrets.SERPER_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}
        run: npm run run-pipeline

      - name: ðŸ“¤ Upload artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: monitoring-results-${{ github.run_number }}
          path: output/
          retention-days: 30

      - name: âœ… Summary
        if: always()
        run: |
          echo "## ðŸŽ¯ Jobdori ëª¨ë‹ˆí„°ë§ ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| í•­ëª© | ê°’ |" >> $GITHUB_STEP_SUMMARY
          echo "|------|-----|" >> $GITHUB_STEP_SUMMARY
          echo "| ì‹¤í–‰ ì‹œê°„ | $(date '+%Y-%m-%d %H:%M:%S UTC') |" >> $GITHUB_STEP_SUMMARY
          echo "| íŠ¸ë¦¬ê±° | ${{ github.event_name }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ìƒíƒœ | ${{ job.status }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŒ [Jobdori ëŒ€ì‹œë³´ë“œ](https://jobdori.vercel.app)" >> $GITHUB_STEP_SUMMARY
